<!DOCTYPE html>
<html>
<head>
    <title>Sage - Free AWS IAM Security Scanner</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #718096;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            margin-top: 40px;
            display: none;
        }
        
        .finding {
            background: #f7fafc;
            border-left: 5px solid;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .critical { border-color: #e53e3e; background: #fff5f5; }
        .high { border-color: #ed8936; background: #fffaf0; }
        .medium { border-color: #ecc94b; background: #fffff0; }
        .low { border-color: #48bb78; background: #f0fff4; }
        
        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .critical-badge { background: #e53e3e; color: white; }
        .high-badge { background: #ed8936; color: white; }
        .medium-badge { background: #ecc94b; color: #744210; }
        .low-badge { background: #48bb78; color: white; }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .summary-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat {
            padding: 10px;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .disclaimer {
            font-size: 14px;
            color: #718096;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Sage Security Scanner</h1>
        <p class="subtitle">Free AWS IAM Security Assessment - No installation required</p>
        
        <div class="alert">
            <strong>‚ö†Ô∏è Security Note:</strong> Your AWS credentials are used temporarily for scanning and are never stored. 
            We recommend using IAM user credentials with read-only permissions.
        </div>
        
        <form id="scanForm">
            <div class="form-group">
                <label for="access_key">AWS Access Key ID</label>
                <input type="text" id="access_key" name="access_key" 
                       placeholder="AKIAIOSFODNN7EXAMPLE" required>
            </div>
            
            <div class="form-group">
                <label for="secret_key">AWS Secret Access Key</label>
                <input type="password" id="secret_key" name="secret_key" 
                       placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY" required>
            </div>
            
            <div class="form-group">
                <label for="region">AWS Region</label>
                <select id="region" name="region">
                    <option value="us-east-1">US East (N. Virginia)</option>
                    <option value="us-west-2">US West (Oregon)</option>
                    <option value="eu-west-1">EU (Ireland)</option>
                    <option value="ap-south-1">Asia Pacific (Mumbai)</option>
                </select>
            </div>
            
            <button type="submit" class="btn" id="scanBtn">
                üîç Start Security Scan
            </button>
        </form>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Scanning your AWS IAM configuration... This may take 1-2 minutes.</p>
            <p><small>Checking users, roles, policies, and security settings</small></p>
        </div>
        
        <div class="results" id="results"></div>
        
        <div class="disclaimer">
            <p><strong>Disclaimer:</strong> This tool performs read-only operations against AWS IAM. 
            It requires IAM permissions equivalent to IAMReadOnlyAccess. We do not store your credentials 
            or scan results. Use at your own risk.</p>
            <p>Built with ‚ù§Ô∏è by Sage Security | <a href="https://github.com/SarahModi/Sage" target="_blank">View on GitHub</a></p>
        </div>
    </div>

    <script>
        document.getElementById('scanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const scanBtn = document.getElementById('scanBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            // Disable button and show loading
            scanBtn.disabled = true;
            scanBtn.innerHTML = '‚è≥ Scanning...';
            loading.style.display = 'block';
            results.style.display = 'none';
            results.innerHTML = '';
            
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/scan', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Scan failed');
                }
                
                displayResults(data);
                
            } catch (error) {
                results.innerHTML = `
                    <div class="finding critical">
                        <span class="severity-badge critical-badge">ERROR</span>
                        <strong>Scan Failed</strong><br>
                        ${error.message}<br>
                        <small>Check your credentials and try again</small>
                    </div>
                `;
                results.style.display = 'block';
            } finally {
                // Reset button and hide loading
                scanBtn.disabled = false;
                scanBtn.innerHTML = 'üîç Start Security Scan';
                loading.style.display = 'none';
            }
        });
        
        function displayResults(data) {
            let html = '';
            
            // Show summary
            if (data.summary) {
                const total = data.summary.total_findings || 0;
                const critical = data.summary.by_severity?.CRITICAL || 0;
                const high = data.summary.by_severity?.HIGH || 0;
                const medium = data.summary.by_severity?.MEDIUM || 0;
                const low = data.summary.by_severity?.LOW || 0;
                
                html += `
                    <div class="summary-card">
                        <h2 style="margin-top:0; color:white;">Scan Complete</h2>
                        <div class="summary-stats">
                            <div class="stat">
                                <span class="stat-number">${total}</span>
                                <span class="stat-label">Total Findings</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" style="color:#e53e3e">${critical}</span>
                                <span class="stat-label">Critical</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" style="color:#ed8936">${high}</span>
                                <span class="stat-label">High</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" style="color:#ecc94b">${medium}</span>
                                <span class="stat-label">Medium</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" style="color:#48bb78">${low}</span>
                                <span class="stat-label">Low</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Show findings if any
                if (data.findings && data.findings.length > 0) {
                    html += '<h2>Security Findings</h2>';
                    
                    data.findings.forEach((finding, index) => {
                        const severity = finding.severity?.toLowerCase() || 'medium';
                        const badgeClass = `${severity}-badge`;
                        const findingClass = severity;
                        
                        html += `
                            <div class="finding ${findingClass}">
                                <span class="severity-badge ${badgeClass}">${finding.severity}</span>
                                <strong>${finding.type}</strong><br><br>
                                
                                <strong>Resource:</strong> ${finding.resource}<br>
                                <strong>Issue:</strong> ${finding.message}<br>
                                <strong>Risk Score:</strong> ${finding.risk_score || 'N/A'}/100<br><br>
                                
                                <strong>üõ†Ô∏è How to Fix:</strong><br>
                                ${finding.fix}
                            </div>
                        `;
                    });
                } else {
                    html += `
                        <div style="text-align: center; padding: 40px;">
                            <h2>üéâ No Security Issues Found!</h2>
                            <p>Your AWS IAM configuration appears to be secure.</p>
                            <p><small>This scan checked for common misconfigurations, but regular security reviews are still recommended.</small></p>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="finding medium">
                        <span class="severity-badge medium-badge">INFO</span>
                        <strong>Scan Completed</strong><br>
                        No detailed results available. The scan may have completed but returned no findings.
                    </div>
                `;
            }
            
            document.getElementById('results').innerHTML = html;
            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>
